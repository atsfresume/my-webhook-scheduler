name: Secure Scheduled Webhook Caller with Random Number

on:
  schedule:
    - cron: '0 14,18,23 * * *'

  
  
  workflow_dispatch:

jobs:
  call_webhook:
    runs-on: ubuntu-latest
    
    steps:
      - name: Call The Secure Webhook URL with Random Number
        run: |
          # 1. تولید یک عدد تصادفی بین 1 تا 7
          RANDOM_NUMBER=$(( ($RANDOM % 7) + 1 ))

          # 2. خواندن URL پایه از سکرت
          BASE_URL="${{ secrets.WEBHOOK_URL }}"

          # 3. بررسی هوشمند که آیا URL از قبل پارامتر دارد یا نه
          if [[ "$BASE_URL" == *"?"* ]]; then
            # اگر پارامتر داشت، از & برای افزودن پارامتر جدید استفاده کن
            FINAL_URL="${BASE_URL}&random_value=${RANDOM_NUMBER}"
          else
            # اگر پارامتر نداشت، از ? برای افزودن اولین پارامتر استفاده کن
            FINAL_URL="${BASE_URL}?random_value=${RANDOM_NUMBER}"
          fi

          # 4. فراخوانی URL نهایی و کاملا صحیح
          echo "Calling the final URL..."
          curl -sf "${FINAL_URL}"
